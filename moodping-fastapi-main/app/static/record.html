<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodPing - ê°ì • ê¸°ë¡</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="auth-header">
        <span class="auth-status" id="auth-status"></span>
        <a href="/auth/kakao" class="btn-kakao" id="btn-login">ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸</a>
        <a href="/auth/logout" class="btn-logout" id="btn-logout" style="display:none;">ë¡œê·¸ì•„ì›ƒ</a>
    </header>
    <div class="container waterfall-container">
        <header>
            <h2>ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€? ğŸŒ™</h2>
        </header>

        <!-- Section 1: ì´ëª¨ì§€ ì„ íƒ (í•­ìƒ í™œì„±) -->
        <section id="section-emoji" class="active-section">
            <h3>ì–´ë–¤ ê°ì •ì¸ê°€ìš”?</h3>
            <div class="emoji-grid">
                <div class="emoji-btn" data-label="happy"     title="ê¸°ì¨">ğŸ˜Š</div>
                <div class="emoji-btn" data-label="excited"   title="ì‹ ë‚¨">ğŸ˜„</div>
                <div class="emoji-btn" data-label="thrilled"  title="ì„¤ë ˜">ğŸ˜</div>
                <div class="emoji-btn" data-label="love"      title="ì‚¬ë‘">ğŸ¥°</div>
                <div class="emoji-btn" data-label="confident" title="ìì‹ ê°">ğŸ˜</div>
                <div class="emoji-btn" data-label="calm"      title="í‰ì˜¨">ğŸ˜Œ</div>
                <div class="emoji-btn" data-label="numb"      title="ë¬´ê°ê°">ğŸ˜</div>
                <div class="emoji-btn" data-label="tired"     title="í”¼ê³¤">ğŸ˜´</div>
                <div class="emoji-btn" data-label="gloomy"    title="ìš°ìš¸">ğŸ˜”</div>
                <div class="emoji-btn" data-label="sad"       title="ìŠ¬í””">ğŸ˜¢</div>
                <div class="emoji-btn" data-label="tearful"   title="ëˆˆë¬¼">ğŸ˜­</div>
                <div class="emoji-btn" data-label="annoyed"   title="ì§œì¦">ğŸ˜¤</div>
                <div class="emoji-btn" data-label="angry"     title="ë¶„ë…¸">ğŸ˜¡</div>
                <div class="emoji-btn" data-label="anxious"   title="ë¶ˆì•ˆ">ğŸ˜°</div>
                <div class="emoji-btn" data-label="scared"    title="ë‘ë ¤ì›€">ğŸ˜¨</div>
            </div>
        </section>

        <!-- Section 2: ê°•ë„ ì„ íƒ (ìŠ¬ë¼ì´ë”) -->
        <section id="section-intensity" class="disabled-section">
            <h3>ì–¼ë§ˆë‚˜ ê°•í•˜ê²Œ ëŠê»´ì§€ë‚˜ìš”?</h3>
            <div class="slider-wrapper">
                <div class="slider-labels">
                    <span>ì „í˜€ ì—†ìŒ</span>
                    <span id="slider-value-display" class="slider-value">5</span>
                    <span>ë§¤ìš° ê°•í•¨</span>
                </div>
                <input type="range" id="intensity-slider" min="0" max="10" value="5" step="1">
                <div class="slider-ticks">
                    <span>0</span><span>1</span><span>2</span><span>3</span><span>4</span>
                    <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span>
                </div>
            </div>
            <button id="intensity-confirm-btn" class="btn-intensity-confirm">ì´ ê°•ë„ë¡œ ì„ íƒ</button>
        </section>

        <!-- Section 3: ë©”ëª¨ & ì €ì¥ -->
        <section id="section-note" class="disabled-section">
            <h3>í•˜ê³  ì‹¶ì€ ë§ì´ ìˆë‚˜ìš”? <span style="font-size:14px;font-weight:normal;color:#999">(ì„ íƒ)</span></h3>
            <textarea id="note-input" rows="3" maxlength="500"
                      placeholder="ì§§ê²Œ ë‚¨ê²¨ì£¼ì…”ë„ ì¢‹ì•„ìš”. (ìµœëŒ€ 500ì)"></textarea>
            <button id="submit-btn" class="btn-primary">AI ë§ˆìŒ ë¶„ì„ë°›ê¸° âœ¨</button>
        </section>

        <!-- Section 4: ë¶„ì„ ê²°ê³¼ -->
        <section id="section-result">
            <div class="result-card">
                <div class="loading-spinner" id="loading-spinner">
                    <div class="spinner"></div>
                    <p>AIê°€ ë§ˆìŒì„ ì½ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
                <div id="result-content" style="display: none;">
                    <h3>AIì˜ ë§ˆìŒ í¸ì§€ ğŸ’Œ</h3>
                    <p id="feedback-text" style="line-height:1.8;color:#2c3e50"></p>
                    <button id="confirm-btn" class="btn-secondary">í™•ì¸ ì™„ë£Œ</button>
                </div>
            </div>
        </section>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/record.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchAuthUser();
            const statusEl = document.getElementById('auth-status');
            const loginEl = document.getElementById('btn-login');
            const logoutEl = document.getElementById('btn-logout');
            if (authUser.logged_in) {
                statusEl.textContent = authUser.nickname + 'ë‹˜';
                loginEl.style.display = 'none';
                logoutEl.style.display = 'inline';
            } else {
                statusEl.textContent = '';
                loginEl.style.display = 'inline';
                logoutEl.style.display = 'none';
            }
        });
    </script>
</body>
</html>
